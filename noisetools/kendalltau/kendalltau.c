/*KENDALLTAU Internal code for homogeneous region detection
**   Please refer to file kendalltau.m

**   License
**   -------
**   This work is protected by the CeCILL-C Licence, see
**   - Licence_CeCILL_V2.1-en.txt
**   - Licence_CeCILL_V2.1-fr.txt
**
**   Copyright 2015 Charles Deledalle
*/

#ifdef MATLAB_MEX_FILE
# include <mex.h>
#endif
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <math.h>
#include <time.h>

#if defined(_WIN32) || defined(_WIN64)
/* For Microsoft Windows SKD C++ compiler */
 #define isnan mxIsNaN
 #define NAN (mxGetNaN())
 double roundf(double number)
 {
   return (number >= 0) ? (int)(number + 0.5) : (int)(number - 0.5);
 }
#endif

/* Lookup table for "1-2*abs(normcdf(linspace(0, 5, 4096), 0, 1) - 0.5)" */
const int normpvalues_2sided_size = 4096;
const double normpvalues_2sided_max = 5;
const double normpvalues_2sided[] = { 1.000000, 0.999026, 0.998052,
0.997077, 0.996103, 0.995129, 0.994155, 0.993181, 0.992206, 0.991232,
0.990258, 0.989284, 0.988310, 0.987336, 0.986362, 0.985388, 0.984414,
0.983439, 0.982465, 0.981492, 0.980518, 0.979544, 0.978570, 0.977596,
0.976622, 0.975648, 0.974675, 0.973701, 0.972727, 0.971754, 0.970780,
0.969806, 0.968833, 0.967860, 0.966886, 0.965913, 0.964939, 0.963966,
0.962993, 0.962020, 0.961047, 0.960074, 0.959101, 0.958128, 0.957155,
0.956182, 0.955210, 0.954237, 0.953264, 0.952292, 0.951319, 0.950347,
0.949375, 0.948402, 0.947430, 0.946458, 0.945486, 0.944514, 0.943543,
0.942571, 0.941599, 0.940628, 0.939656, 0.938685, 0.937713, 0.936742,
0.935771, 0.934800, 0.933829, 0.932858, 0.931888, 0.930917, 0.929947,
0.928976, 0.928006, 0.927036, 0.926066, 0.925096, 0.924126, 0.923156,
0.922186, 0.921217, 0.920247, 0.919278, 0.918309, 0.917340, 0.916371,
0.915402, 0.914433, 0.913465, 0.912497, 0.911528, 0.910560, 0.909592,
0.908624, 0.907656, 0.906689, 0.905721, 0.904754, 0.903787, 0.902820,
0.901853, 0.900886, 0.899919, 0.898953, 0.897987, 0.897020, 0.896054,
0.895089, 0.894123, 0.893157, 0.892192, 0.891227, 0.890262, 0.889297,
0.888332, 0.887367, 0.886403, 0.885439, 0.884475, 0.883511, 0.882547,
0.881584, 0.880620, 0.879657, 0.878694, 0.877731, 0.876768, 0.875806,
0.874844, 0.873881, 0.872920, 0.871958, 0.870996, 0.870035, 0.869074,
0.868113, 0.867152, 0.866191, 0.865231, 0.864271, 0.863311, 0.862351,
0.861391, 0.860432, 0.859473, 0.858514, 0.857555, 0.856597, 0.855638,
0.854680, 0.853722, 0.852765, 0.851807, 0.850850, 0.849893, 0.848936,
0.847979, 0.847023, 0.846067, 0.845111, 0.844155, 0.843200, 0.842245,
0.841290, 0.840335, 0.839380, 0.838426, 0.837472, 0.836518, 0.835565,
0.834611, 0.833658, 0.832705, 0.831753, 0.830800, 0.829848, 0.828896,
0.827945, 0.826993, 0.826042, 0.825091, 0.824141, 0.823191, 0.822240,
0.821291, 0.820341, 0.819392, 0.818443, 0.817494, 0.816546, 0.815597,
0.814649, 0.813702, 0.812754, 0.811807, 0.810860, 0.809914, 0.808967,
0.808021, 0.807076, 0.806130, 0.805185, 0.804240, 0.803296, 0.802351,
0.801407, 0.800464, 0.799520, 0.798577, 0.797634, 0.796692, 0.795749,
0.794807, 0.793866, 0.792924, 0.791983, 0.791042, 0.790102, 0.789162,
0.788222, 0.787282, 0.786343, 0.785404, 0.784466, 0.783527, 0.782589,
0.781652, 0.780714, 0.779777, 0.778841, 0.777904, 0.776968, 0.776032,
0.775097, 0.774162, 0.773227, 0.772293, 0.771359, 0.770425, 0.769491,
0.768558, 0.767625, 0.766693, 0.765761, 0.764829, 0.763898, 0.762967,
0.762036, 0.761106, 0.760176, 0.759246, 0.758316, 0.757387, 0.756459,
0.755531, 0.754603, 0.753675, 0.752748, 0.751821, 0.750894, 0.749968,
0.749042, 0.748117, 0.747192, 0.746267, 0.745343, 0.744419, 0.743495,
0.742572, 0.741649, 0.740727, 0.739804, 0.738883, 0.737961, 0.737040,
0.736120, 0.735199, 0.734280, 0.733360, 0.732441, 0.731522, 0.730604,
0.729686, 0.728768, 0.727851, 0.726934, 0.726018, 0.725102, 0.724186,
0.723271, 0.722356, 0.721442, 0.720528, 0.719614, 0.718701, 0.717788,
0.716876, 0.715964, 0.715052, 0.714141, 0.713230, 0.712320, 0.711410,
0.710500, 0.709591, 0.708682, 0.707774, 0.706866, 0.705959, 0.705051,
0.704145, 0.703239, 0.702333, 0.701427, 0.700522, 0.699618, 0.698714,
0.697810, 0.696907, 0.696004, 0.695102, 0.694200, 0.693298, 0.692397,
0.691496, 0.690596, 0.689696, 0.688797, 0.687898, 0.686999, 0.686101,
0.685204, 0.684307, 0.683410, 0.682514, 0.681618, 0.680723, 0.679828,
0.678933, 0.678039, 0.677146, 0.676252, 0.675360, 0.674468, 0.673576,
0.672685, 0.671794, 0.670903, 0.670014, 0.669124, 0.668235, 0.667347,
0.666459, 0.665571, 0.664684, 0.663797, 0.662911, 0.662025, 0.661140,
0.660255, 0.659371, 0.658487, 0.657604, 0.656721, 0.655839, 0.654957,
0.654076, 0.653195, 0.652314, 0.651434, 0.650555, 0.649676, 0.648797,
0.647919, 0.647042, 0.646165, 0.645288, 0.644412, 0.643537, 0.642662,
0.641787, 0.640913, 0.640040, 0.639167, 0.638294, 0.637422, 0.636550,
0.635679, 0.634809, 0.633939, 0.633069, 0.632200, 0.631332, 0.630464,
0.629596, 0.628729, 0.627863, 0.626997, 0.626131, 0.625266, 0.624402,
0.623538, 0.622674, 0.621812, 0.620949, 0.620087, 0.619226, 0.618365,
0.617505, 0.616645, 0.615786, 0.614927, 0.614069, 0.613212, 0.612354,
0.611498, 0.610642, 0.609786, 0.608931, 0.608077, 0.607223, 0.606370,
0.605517, 0.604664, 0.603813, 0.602961, 0.602111, 0.601261, 0.600411,
0.599562, 0.598713, 0.597865, 0.597018, 0.596171, 0.595325, 0.594479,
0.593634, 0.592789, 0.591945, 0.591101, 0.590258, 0.589416, 0.588574,
0.587733, 0.586892, 0.586052, 0.585212, 0.584373, 0.583534, 0.582696,
0.581859, 0.581022, 0.580186, 0.579350, 0.578515, 0.577680, 0.576846,
0.576013, 0.575180, 0.574347, 0.573516, 0.572684, 0.571854, 0.571024,
0.570194, 0.569365, 0.568537, 0.567709, 0.566882, 0.566055, 0.565229,
0.564404, 0.563579, 0.562755, 0.561931, 0.561108, 0.560285, 0.559463,
0.558642, 0.557821, 0.557001, 0.556182, 0.555363, 0.554544, 0.553726,
0.552909, 0.552092, 0.551276, 0.550461, 0.549646, 0.548832, 0.548018,
0.547205, 0.546393, 0.545581, 0.544769, 0.543959, 0.543149, 0.542339,
0.541530, 0.540722, 0.539914, 0.539107, 0.538301, 0.537495, 0.536690,
0.535885, 0.535081, 0.534278, 0.533475, 0.532672, 0.531871, 0.531070,
0.530270, 0.529470, 0.528671, 0.527872, 0.527074, 0.526277, 0.525480,
0.524684, 0.523889, 0.523094, 0.522300, 0.521506, 0.520713, 0.519921,
0.519129, 0.518338, 0.517547, 0.516758, 0.515968, 0.515180, 0.514392,
0.513604, 0.512818, 0.512032, 0.511246, 0.510461, 0.509677, 0.508893,
0.508111, 0.507328, 0.506547, 0.505765, 0.504985, 0.504205, 0.503426,
0.502648, 0.501870, 0.501093, 0.500316, 0.499540, 0.498765, 0.497990,
0.497216, 0.496443, 0.495670, 0.494898, 0.494126, 0.493355, 0.492585,
0.491816, 0.491047, 0.490279, 0.489511, 0.488744, 0.487978, 0.487212,
0.486447, 0.485683, 0.484919, 0.484156, 0.483394, 0.482632, 0.481871,
0.481110, 0.480351, 0.479592, 0.478833, 0.478075, 0.477318, 0.476562,
0.475806, 0.475051, 0.474296, 0.473542, 0.472789, 0.472036, 0.471284,
0.470533, 0.469783, 0.469033, 0.468284, 0.467535, 0.466787, 0.466040,
0.465293, 0.464547, 0.463802, 0.463057, 0.462313, 0.461570, 0.460828,
0.460086, 0.459344, 0.458604, 0.457864, 0.457125, 0.456386, 0.455648,
0.454911, 0.454174, 0.453439, 0.452703, 0.451969, 0.451235, 0.450502,
0.449769, 0.449037, 0.448306, 0.447576, 0.446846, 0.446117, 0.445388,
0.444661, 0.443934, 0.443207, 0.442481, 0.441756, 0.441032, 0.440308,
0.439585, 0.438863, 0.438141, 0.437420, 0.436700, 0.435980, 0.435262,
0.434543, 0.433826, 0.433109, 0.432393, 0.431677, 0.430962, 0.430248,
0.429535, 0.428822, 0.428110, 0.427399, 0.426688, 0.425978, 0.425269,
0.424560, 0.423852, 0.423145, 0.422439, 0.421733, 0.421028, 0.420323,
0.419619, 0.418916, 0.418214, 0.417512, 0.416811, 0.416111, 0.415411,
0.414712, 0.414014, 0.413317, 0.412620, 0.411924, 0.411228, 0.410534,
0.409840, 0.409146, 0.408454, 0.407762, 0.407071, 0.406380, 0.405690,
0.405001, 0.404313, 0.403625, 0.402938, 0.402252, 0.401566, 0.400881,
0.400197, 0.399513, 0.398830, 0.398148, 0.397467, 0.396786, 0.396106,
0.395427, 0.394748, 0.394070, 0.393393, 0.392717, 0.392041, 0.391366,
0.390692, 0.390018, 0.389345, 0.388673, 0.388001, 0.387330, 0.386660,
0.385991, 0.385322, 0.384654, 0.383987, 0.383320, 0.382654, 0.381989,
0.381325, 0.380661, 0.379998, 0.379336, 0.378674, 0.378013, 0.377353,
0.376694, 0.376035, 0.375377, 0.374719, 0.374063, 0.373407, 0.372752,
0.372097, 0.371443, 0.370790, 0.370138, 0.369486, 0.368835, 0.368185,
0.367536, 0.366887, 0.366239, 0.365592, 0.364945, 0.364299, 0.363654,
0.363009, 0.362366, 0.361722, 0.361080, 0.360438, 0.359798, 0.359157,
0.358518, 0.357879, 0.357241, 0.356604, 0.355967, 0.355331, 0.354696,
0.354062, 0.353428, 0.352795, 0.352163, 0.351531, 0.350900, 0.350270,
0.349640, 0.349012, 0.348384, 0.347756, 0.347130, 0.346504, 0.345879,
0.345255, 0.344631, 0.344008, 0.343386, 0.342764, 0.342143, 0.341523,
0.340904, 0.340285, 0.339667, 0.339050, 0.338434, 0.337818, 0.337203,
0.336588, 0.335975, 0.335362, 0.334750, 0.334138, 0.333528, 0.332918,
0.332308, 0.331700, 0.331092, 0.330485, 0.329878, 0.329273, 0.328668,
0.328063, 0.327460, 0.326857, 0.326255, 0.325654, 0.325053, 0.324453,
0.323854, 0.323256, 0.322658, 0.322061, 0.321464, 0.320869, 0.320274,
0.319680, 0.319086, 0.318494, 0.317902, 0.317311, 0.316720, 0.316130,
0.315541, 0.314953, 0.314365, 0.313778, 0.313192, 0.312606, 0.312022,
0.311438, 0.310854, 0.310272, 0.309690, 0.309109, 0.308528, 0.307949,
0.307370, 0.306791, 0.306214, 0.305637, 0.305061, 0.304485, 0.303911,
0.303337, 0.302764, 0.302191, 0.301619, 0.301048, 0.300478, 0.299908,
0.299339, 0.298771, 0.298204, 0.297637, 0.297071, 0.296506, 0.295941,
0.295377, 0.294814, 0.294252, 0.293690, 0.293129, 0.292569, 0.292009,
0.291450, 0.290892, 0.290335, 0.289778, 0.289222, 0.288667, 0.288113,
0.287559, 0.287006, 0.286453, 0.285902, 0.285351, 0.284801, 0.284251,
0.283702, 0.283154, 0.282607, 0.282061, 0.281515, 0.280969, 0.280425,
0.279881, 0.279338, 0.278796, 0.278254, 0.277714, 0.277173, 0.276634,
0.276095, 0.275557, 0.275020, 0.274483, 0.273947, 0.273412, 0.272878,
0.272344, 0.271811, 0.271279, 0.270747, 0.270217, 0.269686, 0.269157,
0.268628, 0.268100, 0.267573, 0.267046, 0.266521, 0.265995, 0.265471,
0.264947, 0.264424, 0.263902, 0.263380, 0.262859, 0.262339, 0.261820,
0.261301, 0.260783, 0.260266, 0.259749, 0.259233, 0.258718, 0.258204,
0.257690, 0.257177, 0.256664, 0.256153, 0.255642, 0.255132, 0.254622,
0.254113, 0.253605, 0.253098, 0.252591, 0.252085, 0.251580, 0.251075,
0.250572, 0.250068, 0.249566, 0.249064, 0.248563, 0.248063, 0.247563,
0.247064, 0.246566, 0.246069, 0.245572, 0.245076, 0.244580, 0.244086,
0.243592, 0.243098, 0.242606, 0.242114, 0.241623, 0.241132, 0.240643,
0.240154, 0.239665, 0.239177, 0.238691, 0.238204, 0.237719, 0.237234,
0.236750, 0.236266, 0.235783, 0.235301, 0.234820, 0.234339, 0.233859,
0.233380, 0.232901, 0.232424, 0.231946, 0.231470, 0.230994, 0.230519,
0.230045, 0.229571, 0.229098, 0.228625, 0.228154, 0.227683, 0.227213,
0.226743, 0.226274, 0.225806, 0.225339, 0.224872, 0.224406, 0.223940,
0.223476, 0.223012, 0.222548, 0.222086, 0.221624, 0.221162, 0.220702,
0.220242, 0.219783, 0.219324, 0.218866, 0.218409, 0.217953, 0.217497,
0.217042, 0.216587, 0.216134, 0.215681, 0.215228, 0.214777, 0.214326,
0.213875, 0.213426, 0.212977, 0.212529, 0.212081, 0.211634, 0.211188,
0.210743, 0.210298, 0.209854, 0.209410, 0.208967, 0.208525, 0.208084,
0.207643, 0.207203, 0.206763, 0.206325, 0.205887, 0.205449, 0.205013,
0.204577, 0.204141, 0.203706, 0.203272, 0.202839, 0.202406, 0.201975,
0.201543, 0.201113, 0.200683, 0.200253, 0.199825, 0.199397, 0.198969,
0.198543, 0.198117, 0.197692, 0.197267, 0.196843, 0.196420, 0.195997,
0.195575, 0.195154, 0.194733, 0.194313, 0.193894, 0.193475, 0.193058,
0.192640, 0.192224, 0.191808, 0.191392, 0.190978, 0.190564, 0.190150,
0.189738, 0.189326, 0.188914, 0.188504, 0.188094, 0.187684, 0.187276,
0.186868, 0.186460, 0.186054, 0.185647, 0.185242, 0.184837, 0.184433,
0.184030, 0.183627, 0.183225, 0.182823, 0.182422, 0.182022, 0.181623,
0.181224, 0.180826, 0.180428, 0.180031, 0.179635, 0.179239, 0.178844,
0.178450, 0.178056, 0.177663, 0.177271, 0.176879, 0.176488, 0.176097,
0.175708, 0.175318, 0.174930, 0.174542, 0.174155, 0.173768, 0.173382,
0.172997, 0.172612, 0.172228, 0.171845, 0.171462, 0.171080, 0.170698,
0.170317, 0.169937, 0.169558, 0.169179, 0.168800, 0.168423, 0.168046,
0.167669, 0.167294, 0.166918, 0.166544, 0.166170, 0.165797, 0.165424,
0.165052, 0.164681, 0.164310, 0.163940, 0.163571, 0.163202, 0.162834,
0.162466, 0.162099, 0.161733, 0.161367, 0.161002, 0.160638, 0.160274,
0.159911, 0.159548, 0.159186, 0.158825, 0.158464, 0.158104, 0.157744,
0.157386, 0.157027, 0.156670, 0.156313, 0.155956, 0.155601, 0.155245,
0.154891, 0.154537, 0.154184, 0.153831, 0.153479, 0.153127, 0.152777,
0.152426, 0.152077, 0.151728, 0.151379, 0.151032, 0.150684, 0.150338,
0.149992, 0.149646, 0.149302, 0.148958, 0.148614, 0.148271, 0.147929,
0.147587, 0.147246, 0.146905, 0.146565, 0.146226, 0.145887, 0.145549,
0.145212, 0.144875, 0.144539, 0.144203, 0.143868, 0.143533, 0.143199,
0.142866, 0.142533, 0.142201, 0.141870, 0.141539, 0.141208, 0.140878,
0.140549, 0.140221, 0.139893, 0.139565, 0.139239, 0.138912, 0.138587,
0.138262, 0.137937, 0.137613, 0.137290, 0.136967, 0.136645, 0.136324,
0.136003, 0.135683, 0.135363, 0.135044, 0.134725, 0.134407, 0.134089,
0.133773, 0.133456, 0.133141, 0.132826, 0.132511, 0.132197, 0.131884,
0.131571, 0.131259, 0.130947, 0.130636, 0.130325, 0.130015, 0.129706,
0.129397, 0.129089, 0.128781, 0.128474, 0.128168, 0.127862, 0.127556,
0.127251, 0.126947, 0.126644, 0.126340, 0.126038, 0.125736, 0.125434,
0.125134, 0.124833, 0.124534, 0.124234, 0.123936, 0.123638, 0.123340,
0.123043, 0.122747, 0.122451, 0.122156, 0.121861, 0.121567, 0.121273,
0.120980, 0.120688, 0.120396, 0.120105, 0.119814, 0.119524, 0.119234,
0.118945, 0.118656, 0.118368, 0.118080, 0.117793, 0.117507, 0.117221,
0.116936, 0.116651, 0.116367, 0.116083, 0.115800, 0.115517, 0.115235,
0.114954, 0.114673, 0.114392, 0.114112, 0.113833, 0.113554, 0.113276,
0.112998, 0.112721, 0.112444, 0.112168, 0.111893, 0.111618, 0.111343,
0.111069, 0.110796, 0.110523, 0.110250, 0.109978, 0.109707, 0.109436,
0.109166, 0.108896, 0.108627, 0.108358, 0.108090, 0.107822, 0.107555,
0.107289, 0.107023, 0.106757, 0.106492, 0.106227, 0.105963, 0.105700,
0.105437, 0.105175, 0.104913, 0.104651, 0.104390, 0.104130, 0.103870,
0.103611, 0.103352, 0.103094, 0.102836, 0.102579, 0.102322, 0.102066,
0.101810, 0.101555, 0.101300, 0.101046, 0.100792, 0.100539, 0.100286,
0.100034, 0.099782, 0.099531, 0.099281, 0.099030, 0.098781, 0.098532,
0.098283, 0.098035, 0.097787, 0.097540, 0.097293, 0.097047, 0.096802,
0.096556, 0.096312, 0.096068, 0.095824, 0.095581, 0.095338, 0.095096,
0.094854, 0.094613, 0.094372, 0.094132, 0.093892, 0.093653, 0.093414,
0.093176, 0.092938, 0.092701, 0.092464, 0.092228, 0.091992, 0.091757,
0.091522, 0.091288, 0.091054, 0.090820, 0.090587, 0.090355, 0.090123,
0.089891, 0.089660, 0.089430, 0.089200, 0.088970, 0.088741, 0.088513,
0.088284, 0.088057, 0.087830, 0.087603, 0.087377, 0.087151, 0.086925,
0.086701, 0.086476, 0.086252, 0.086029, 0.085806, 0.085583, 0.085361,
0.085140, 0.084919, 0.084698, 0.084478, 0.084258, 0.084039, 0.083820,
0.083602, 0.083384, 0.083167, 0.082950, 0.082733, 0.082517, 0.082302,
0.082087, 0.081872, 0.081658, 0.081444, 0.081231, 0.081018, 0.080805,
0.080594, 0.080382, 0.080171, 0.079960, 0.079750, 0.079541, 0.079331,
0.079123, 0.078914, 0.078706, 0.078499, 0.078292, 0.078085, 0.077879,
0.077674, 0.077468, 0.077264, 0.077059, 0.076855, 0.076652, 0.076449,
0.076246, 0.076044, 0.075842, 0.075641, 0.075440, 0.075240, 0.075040,
0.074840, 0.074641, 0.074443, 0.074244, 0.074047, 0.073849, 0.073652,
0.073456, 0.073260, 0.073064, 0.072869, 0.072674, 0.072480, 0.072286,
0.072092, 0.071899, 0.071707, 0.071514, 0.071322, 0.071131, 0.070940,
0.070750, 0.070559, 0.070370, 0.070180, 0.069991, 0.069803, 0.069615,
0.069427, 0.069240, 0.069053, 0.068867, 0.068681, 0.068495, 0.068310,
0.068125, 0.067941, 0.067757, 0.067574, 0.067391, 0.067208, 0.067026,
0.066844, 0.066662, 0.066481, 0.066301, 0.066120, 0.065941, 0.065761,
0.065582, 0.065403, 0.065225, 0.065047, 0.064870, 0.064693, 0.064516,
0.064340, 0.064164, 0.063989, 0.063814, 0.063639, 0.063465, 0.063291,
0.063117, 0.062944, 0.062772, 0.062599, 0.062427, 0.062256, 0.062085,
0.061914, 0.061744, 0.061574, 0.061404, 0.061235, 0.061066, 0.060898,
0.060730, 0.060562, 0.060395, 0.060228, 0.060061, 0.059895, 0.059730,
0.059564, 0.059399, 0.059235, 0.059071, 0.058907, 0.058743, 0.058580,
0.058417, 0.058255, 0.058093, 0.057932, 0.057770, 0.057610, 0.057449,
0.057289, 0.057129, 0.056970, 0.056811, 0.056652, 0.056494, 0.056336,
0.056179, 0.056022, 0.055865, 0.055709, 0.055552, 0.055397, 0.055241,
0.055087, 0.054932, 0.054778, 0.054624, 0.054470, 0.054317, 0.054164,
0.054012, 0.053860, 0.053708, 0.053557, 0.053406, 0.053255, 0.053105,
0.052955, 0.052806, 0.052656, 0.052507, 0.052359, 0.052211, 0.052063,
0.051915, 0.051768, 0.051622, 0.051475, 0.051329, 0.051183, 0.051038,
0.050893, 0.050748, 0.050604, 0.050460, 0.050316, 0.050173, 0.050030,
0.049887, 0.049745, 0.049603, 0.049462, 0.049320, 0.049179, 0.049039,
0.048899, 0.048759, 0.048619, 0.048480, 0.048341, 0.048202, 0.048064,
0.047926, 0.047789, 0.047651, 0.047515, 0.047378, 0.047242, 0.047106,
0.046970, 0.046835, 0.046700, 0.046565, 0.046431, 0.046297, 0.046164,
0.046030, 0.045897, 0.045765, 0.045632, 0.045500, 0.045369, 0.045237,
0.045106, 0.044975, 0.044845, 0.044715, 0.044585, 0.044456, 0.044327,
0.044198, 0.044069, 0.043941, 0.043813, 0.043686, 0.043558, 0.043432,
0.043305, 0.043179, 0.043053, 0.042927, 0.042802, 0.042677, 0.042552,
0.042427, 0.042303, 0.042179, 0.042056, 0.041933, 0.041810, 0.041687,
0.041565, 0.041443, 0.041321, 0.041200, 0.041079, 0.040958, 0.040837,
0.040717, 0.040597, 0.040478, 0.040358, 0.040239, 0.040121, 0.040002,
0.039884, 0.039767, 0.039649, 0.039532, 0.039415, 0.039298, 0.039182,
0.039066, 0.038950, 0.038835, 0.038720, 0.038605, 0.038490, 0.038376,
0.038262, 0.038148, 0.038035, 0.037922, 0.037809, 0.037696, 0.037584,
0.037472, 0.037360, 0.037249, 0.037138, 0.037027, 0.036916, 0.036806,
0.036696, 0.036586, 0.036477, 0.036367, 0.036258, 0.036150, 0.036041,
0.035933, 0.035826, 0.035718, 0.035611, 0.035504, 0.035397, 0.035291,
0.035185, 0.035079, 0.034973, 0.034868, 0.034763, 0.034658, 0.034553,
0.034449, 0.034345, 0.034242, 0.034138, 0.034035, 0.033932, 0.033829,
0.033727, 0.033625, 0.033523, 0.033421, 0.033320, 0.033219, 0.033118,
0.033018, 0.032917, 0.032817, 0.032718, 0.032618, 0.032519, 0.032420,
0.032321, 0.032223, 0.032125, 0.032027, 0.031929, 0.031832, 0.031734,
0.031637, 0.031541, 0.031444, 0.031348, 0.031252, 0.031157, 0.031061,
0.030966, 0.030871, 0.030776, 0.030682, 0.030588, 0.030494, 0.030400,
0.030307, 0.030214, 0.030121, 0.030028, 0.029936, 0.029844, 0.029752,
0.029660, 0.029568, 0.029477, 0.029386, 0.029295, 0.029205, 0.029115,
0.029025, 0.028935, 0.028845, 0.028756, 0.028667, 0.028578, 0.028490,
0.028401, 0.028313, 0.028225, 0.028138, 0.028050, 0.027963, 0.027876,
0.027790, 0.027703, 0.027617, 0.027531, 0.027445, 0.027360, 0.027274,
0.027189, 0.027104, 0.027020, 0.026935, 0.026851, 0.026767, 0.026683,
0.026600, 0.026517, 0.026434, 0.026351, 0.026268, 0.026186, 0.026104,
0.026022, 0.025940, 0.025859, 0.025777, 0.025696, 0.025616, 0.025535,
0.025455, 0.025374, 0.025295, 0.025215, 0.025135, 0.025056, 0.024977,
0.024898, 0.024820, 0.024741, 0.024663, 0.024585, 0.024507, 0.024430,
0.024352, 0.024275, 0.024198, 0.024121, 0.024045, 0.023969, 0.023893,
0.023817, 0.023741, 0.023666, 0.023590, 0.023515, 0.023440, 0.023366,
0.023291, 0.023217, 0.023143, 0.023069, 0.022996, 0.022922, 0.022849,
0.022776, 0.022703, 0.022631, 0.022558, 0.022486, 0.022414, 0.022343,
0.022271, 0.022200, 0.022128, 0.022057, 0.021987, 0.021916, 0.021846,
0.021775, 0.021705, 0.021636, 0.021566, 0.021497, 0.021427, 0.021358,
0.021290, 0.021221, 0.021153, 0.021084, 0.021016, 0.020948, 0.020881,
0.020813, 0.020746, 0.020679, 0.020612, 0.020545, 0.020479, 0.020412,
0.020346, 0.020280, 0.020214, 0.020149, 0.020083, 0.020018, 0.019953,
0.019888, 0.019824, 0.019759, 0.019695, 0.019631, 0.019567, 0.019503,
0.019439, 0.019376, 0.019313, 0.019250, 0.019187, 0.019124, 0.019062,
0.018999, 0.018937, 0.018875, 0.018813, 0.018752, 0.018690, 0.018629,
0.018568, 0.018507, 0.018446, 0.018386, 0.018326, 0.018265, 0.018205,
0.018145, 0.018086, 0.018026, 0.017967, 0.017908, 0.017849, 0.017790,
0.017731, 0.017673, 0.017614, 0.017556, 0.017498, 0.017440, 0.017383,
0.017325, 0.017268, 0.017211, 0.017154, 0.017097, 0.017040, 0.016984,
0.016928, 0.016871, 0.016815, 0.016760, 0.016704, 0.016648, 0.016593,
0.016538, 0.016483, 0.016428, 0.016373, 0.016319, 0.016264, 0.016210,
0.016156, 0.016102, 0.016048, 0.015995, 0.015941, 0.015888, 0.015835,
0.015782, 0.015729, 0.015676, 0.015624, 0.015572, 0.015519, 0.015467,
0.015416, 0.015364, 0.015312, 0.015261, 0.015210, 0.015158, 0.015107,
0.015057, 0.015006, 0.014955, 0.014905, 0.014855, 0.014805, 0.014755,
0.014705, 0.014656, 0.014606, 0.014557, 0.014508, 0.014459, 0.014410,
0.014361, 0.014312, 0.014264, 0.014216, 0.014167, 0.014119, 0.014071,
0.014024, 0.013976, 0.013929, 0.013881, 0.013834, 0.013787, 0.013740,
0.013694, 0.013647, 0.013601, 0.013554, 0.013508, 0.013462, 0.013416,
0.013370, 0.013325, 0.013279, 0.013234, 0.013189, 0.013144, 0.013099,
0.013054, 0.013009, 0.012965, 0.012920, 0.012876, 0.012832, 0.012788,
0.012744, 0.012700, 0.012657, 0.012613, 0.012570, 0.012527, 0.012484,
0.012441, 0.012398, 0.012355, 0.012313, 0.012270, 0.012228, 0.012186,
0.012144, 0.012102, 0.012060, 0.012019, 0.011977, 0.011936, 0.011894,
0.011853, 0.011812, 0.011771, 0.011731, 0.011690, 0.011649, 0.011609,
0.011569, 0.011529, 0.011489, 0.011449, 0.011409, 0.011369, 0.011330,
0.011290, 0.011251, 0.011212, 0.011173, 0.011134, 0.011095, 0.011057,
0.011018, 0.010980, 0.010941, 0.010903, 0.010865, 0.010827, 0.010789,
0.010752, 0.010714, 0.010676, 0.010639, 0.010602, 0.010565, 0.010528,
0.010491, 0.010454, 0.010417, 0.010381, 0.010344, 0.010308, 0.010272,
0.010236, 0.010200, 0.010164, 0.010128, 0.010092, 0.010057, 0.010021,
0.009986, 0.009951, 0.009916, 0.009881, 0.009846, 0.009811, 0.009776,
0.009742, 0.009707, 0.009673, 0.009639, 0.009605, 0.009571, 0.009537,
0.009503, 0.009469, 0.009436, 0.009402, 0.009369, 0.009336, 0.009302,
0.009269, 0.009236, 0.009204, 0.009171, 0.009138, 0.009106, 0.009073,
0.009041, 0.009009, 0.008977, 0.008945, 0.008913, 0.008881, 0.008849,
0.008818, 0.008786, 0.008755, 0.008723, 0.008692, 0.008661, 0.008630,
0.008599, 0.008568, 0.008538, 0.008507, 0.008476, 0.008446, 0.008416,
0.008385, 0.008355, 0.008325, 0.008295, 0.008266, 0.008236, 0.008206,
0.008177, 0.008147, 0.008118, 0.008089, 0.008059, 0.008030, 0.008001,
0.007972, 0.007944, 0.007915, 0.007886, 0.007858, 0.007829, 0.007801,
0.007773, 0.007745, 0.007717, 0.007689, 0.007661, 0.007633, 0.007605,
0.007578, 0.007550, 0.007523, 0.007495, 0.007468, 0.007441, 0.007414,
0.007387, 0.007360, 0.007333, 0.007307, 0.007280, 0.007253, 0.007227,
0.007201, 0.007174, 0.007148, 0.007122, 0.007096, 0.007070, 0.007044,
0.007018, 0.006993, 0.006967, 0.006942, 0.006916, 0.006891, 0.006866,
0.006840, 0.006815, 0.006790, 0.006765, 0.006740, 0.006716, 0.006691,
0.006666, 0.006642, 0.006617, 0.006593, 0.006569, 0.006545, 0.006520,
0.006496, 0.006472, 0.006449, 0.006425, 0.006401, 0.006377, 0.006354,
0.006330, 0.006307, 0.006284, 0.006260, 0.006237, 0.006214, 0.006191,
0.006168, 0.006145, 0.006122, 0.006100, 0.006077, 0.006055, 0.006032,
0.006010, 0.005987, 0.005965, 0.005943, 0.005921, 0.005899, 0.005877,
0.005855, 0.005833, 0.005811, 0.005790, 0.005768, 0.005747, 0.005725,
0.005704, 0.005682, 0.005661, 0.005640, 0.005619, 0.005598, 0.005577,
0.005556, 0.005535, 0.005514, 0.005494, 0.005473, 0.005453, 0.005432,
0.005412, 0.005391, 0.005371, 0.005351, 0.005331, 0.005311, 0.005291,
0.005271, 0.005251, 0.005231, 0.005212, 0.005192, 0.005172, 0.005153,
0.005134, 0.005114, 0.005095, 0.005076, 0.005056, 0.005037, 0.005018,
0.004999, 0.004980, 0.004961, 0.004943, 0.004924, 0.004905, 0.004887,
0.004868, 0.004850, 0.004831, 0.004813, 0.004795, 0.004776, 0.004758,
0.004740, 0.004722, 0.004704, 0.004686, 0.004668, 0.004651, 0.004633,
0.004615, 0.004598, 0.004580, 0.004563, 0.004545, 0.004528, 0.004511,
0.004493, 0.004476, 0.004459, 0.004442, 0.004425, 0.004408, 0.004391,
0.004374, 0.004358, 0.004341, 0.004324, 0.004308, 0.004291, 0.004275,
0.004258, 0.004242, 0.004226, 0.004209, 0.004193, 0.004177, 0.004161,
0.004145, 0.004129, 0.004113, 0.004097, 0.004081, 0.004066, 0.004050,
0.004034, 0.004019, 0.004003, 0.003988, 0.003972, 0.003957, 0.003942,
0.003927, 0.003911, 0.003896, 0.003881, 0.003866, 0.003851, 0.003836,
0.003821, 0.003806, 0.003792, 0.003777, 0.003762, 0.003748, 0.003733,
0.003719, 0.003704, 0.003690, 0.003675, 0.003661, 0.003647, 0.003633,
0.003618, 0.003604, 0.003590, 0.003576, 0.003562, 0.003548, 0.003534,
0.003521, 0.003507, 0.003493, 0.003480, 0.003466, 0.003452, 0.003439,
0.003425, 0.003412, 0.003399, 0.003385, 0.003372, 0.003359, 0.003346,
0.003332, 0.003319, 0.003306, 0.003293, 0.003280, 0.003267, 0.003255,
0.003242, 0.003229, 0.003216, 0.003204, 0.003191, 0.003178, 0.003166,
0.003153, 0.003141, 0.003128, 0.003116, 0.003104, 0.003092, 0.003079,
0.003067, 0.003055, 0.003043, 0.003031, 0.003019, 0.003007, 0.002995,
0.002983, 0.002971, 0.002959, 0.002948, 0.002936, 0.002924, 0.002913,
0.002901, 0.002890, 0.002878, 0.002867, 0.002855, 0.002844, 0.002833,
0.002821, 0.002810, 0.002799, 0.002788, 0.002777, 0.002765, 0.002754,
0.002743, 0.002732, 0.002722, 0.002711, 0.002700, 0.002689, 0.002678,
0.002668, 0.002657, 0.002646, 0.002636, 0.002625, 0.002614, 0.002604,
0.002594, 0.002583, 0.002573, 0.002562, 0.002552, 0.002542, 0.002532,
0.002521, 0.002511, 0.002501, 0.002491, 0.002481, 0.002471, 0.002461,
0.002451, 0.002441, 0.002431, 0.002422, 0.002412, 0.002402, 0.002392,
0.002383, 0.002373, 0.002363, 0.002354, 0.002344, 0.002335, 0.002325,
0.002316, 0.002307, 0.002297, 0.002288, 0.002279, 0.002269, 0.002260,
0.002251, 0.002242, 0.002233, 0.002224, 0.002215, 0.002206, 0.002197,
0.002188, 0.002179, 0.002170, 0.002161, 0.002152, 0.002143, 0.002135,
0.002126, 0.002117, 0.002109, 0.002100, 0.002091, 0.002083, 0.002074,
0.002066, 0.002057, 0.002049, 0.002041, 0.002032, 0.002024, 0.002016,
0.002007, 0.001999, 0.001991, 0.001983, 0.001975, 0.001967, 0.001958,
0.001950, 0.001942, 0.001934, 0.001926, 0.001919, 0.001911, 0.001903,
0.001895, 0.001887, 0.001879, 0.001872, 0.001864, 0.001856, 0.001848,
0.001841, 0.001833, 0.001826, 0.001818, 0.001811, 0.001803, 0.001796,
0.001788, 0.001781, 0.001773, 0.001766, 0.001759, 0.001751, 0.001744,
0.001737, 0.001730, 0.001723, 0.001715, 0.001708, 0.001701, 0.001694,
0.001687, 0.001680, 0.001673, 0.001666, 0.001659, 0.001652, 0.001645,
0.001639, 0.001632, 0.001625, 0.001618, 0.001611, 0.001605, 0.001598,
0.001591, 0.001585, 0.001578, 0.001571, 0.001565, 0.001558, 0.001552,
0.001545, 0.001539, 0.001532, 0.001526, 0.001519, 0.001513, 0.001507,
0.001500, 0.001494, 0.001488, 0.001482, 0.001475, 0.001469, 0.001463,
0.001457, 0.001451, 0.001445, 0.001438, 0.001432, 0.001426, 0.001420,
0.001414, 0.001408, 0.001402, 0.001397, 0.001391, 0.001385, 0.001379,
0.001373, 0.001367, 0.001362, 0.001356, 0.001350, 0.001344, 0.001339,
0.001333, 0.001327, 0.001322, 0.001316, 0.001310, 0.001305, 0.001299,
0.001294, 0.001288, 0.001283, 0.001277, 0.001272, 0.001267, 0.001261,
0.001256, 0.001250, 0.001245, 0.001240, 0.001235, 0.001229, 0.001224,
0.001219, 0.001214, 0.001208, 0.001203, 0.001198, 0.001193, 0.001188,
0.001183, 0.001178, 0.001173, 0.001168, 0.001163, 0.001158, 0.001153,
0.001148, 0.001143, 0.001138, 0.001133, 0.001128, 0.001123, 0.001119,
0.001114, 0.001109, 0.001104, 0.001100, 0.001095, 0.001090, 0.001085,
0.001081, 0.001076, 0.001071, 0.001067, 0.001062, 0.001058, 0.001053,
0.001049, 0.001044, 0.001040, 0.001035, 0.001031, 0.001026, 0.001022,
0.001017, 0.001013, 0.001008, 0.001004, 0.001000, 0.000995, 0.000991,
0.000987, 0.000983, 0.000978, 0.000974, 0.000970, 0.000966, 0.000961,
0.000957, 0.000953, 0.000949, 0.000945, 0.000941, 0.000937, 0.000933,
0.000928, 0.000924, 0.000920, 0.000916, 0.000912, 0.000908, 0.000904,
0.000900, 0.000897, 0.000893, 0.000889, 0.000885, 0.000881, 0.000877,
0.000873, 0.000869, 0.000866, 0.000862, 0.000858, 0.000854, 0.000851,
0.000847, 0.000843, 0.000839, 0.000836, 0.000832, 0.000828, 0.000825,
0.000821, 0.000818, 0.000814, 0.000810, 0.000807, 0.000803, 0.000800,
0.000796, 0.000793, 0.000789, 0.000786, 0.000782, 0.000779, 0.000775,
0.000772, 0.000769, 0.000765, 0.000762, 0.000758, 0.000755, 0.000752,
0.000748, 0.000745, 0.000742, 0.000739, 0.000735, 0.000732, 0.000729,
0.000726, 0.000722, 0.000719, 0.000716, 0.000713, 0.000710, 0.000706,
0.000703, 0.000700, 0.000697, 0.000694, 0.000691, 0.000688, 0.000685,
0.000682, 0.000679, 0.000676, 0.000673, 0.000670, 0.000667, 0.000664,
0.000661, 0.000658, 0.000655, 0.000652, 0.000649, 0.000646, 0.000643,
0.000640, 0.000637, 0.000635, 0.000632, 0.000629, 0.000626, 0.000623,
0.000621, 0.000618, 0.000615, 0.000612, 0.000610, 0.000607, 0.000604,
0.000601, 0.000599, 0.000596, 0.000593, 0.000591, 0.000588, 0.000585,
0.000583, 0.000580, 0.000577, 0.000575, 0.000572, 0.000570, 0.000567,
0.000565, 0.000562, 0.000559, 0.000557, 0.000554, 0.000552, 0.000549,
0.000547, 0.000544, 0.000542, 0.000540, 0.000537, 0.000535, 0.000532,
0.000530, 0.000527, 0.000525, 0.000523, 0.000520, 0.000518, 0.000516,
0.000513, 0.000511, 0.000509, 0.000506, 0.000504, 0.000502, 0.000499,
0.000497, 0.000495, 0.000493, 0.000490, 0.000488, 0.000486, 0.000484,
0.000482, 0.000479, 0.000477, 0.000475, 0.000473, 0.000471, 0.000468,
0.000466, 0.000464, 0.000462, 0.000460, 0.000458, 0.000456, 0.000454,
0.000452, 0.000450, 0.000447, 0.000445, 0.000443, 0.000441, 0.000439,
0.000437, 0.000435, 0.000433, 0.000431, 0.000429, 0.000427, 0.000425,
0.000423, 0.000421, 0.000420, 0.000418, 0.000416, 0.000414, 0.000412,
0.000410, 0.000408, 0.000406, 0.000404, 0.000402, 0.000401, 0.000399,
0.000397, 0.000395, 0.000393, 0.000391, 0.000390, 0.000388, 0.000386,
0.000384, 0.000382, 0.000381, 0.000379, 0.000377, 0.000375, 0.000374,
0.000372, 0.000370, 0.000369, 0.000367, 0.000365, 0.000363, 0.000362,
0.000360, 0.000358, 0.000357, 0.000355, 0.000353, 0.000352, 0.000350,
0.000348, 0.000347, 0.000345, 0.000344, 0.000342, 0.000340, 0.000339,
0.000337, 0.000336, 0.000334, 0.000333, 0.000331, 0.000329, 0.000328,
0.000326, 0.000325, 0.000323, 0.000322, 0.000320, 0.000319, 0.000317,
0.000316, 0.000314, 0.000313, 0.000311, 0.000310, 0.000308, 0.000307,
0.000306, 0.000304, 0.000303, 0.000301, 0.000300, 0.000298, 0.000297,
0.000296, 0.000294, 0.000293, 0.000292, 0.000290, 0.000289, 0.000287,
0.000286, 0.000285, 0.000283, 0.000282, 0.000281, 0.000279, 0.000278,
0.000277, 0.000275, 0.000274, 0.000273, 0.000272, 0.000270, 0.000269,
0.000268, 0.000266, 0.000265, 0.000264, 0.000263, 0.000261, 0.000260,
0.000259, 0.000258, 0.000257, 0.000255, 0.000254, 0.000253, 0.000252,
0.000250, 0.000249, 0.000248, 0.000247, 0.000246, 0.000245, 0.000243,
0.000242, 0.000241, 0.000240, 0.000239, 0.000238, 0.000237, 0.000235,
0.000234, 0.000233, 0.000232, 0.000231, 0.000230, 0.000229, 0.000228,
0.000227, 0.000225, 0.000224, 0.000223, 0.000222, 0.000221, 0.000220,
0.000219, 0.000218, 0.000217, 0.000216, 0.000215, 0.000214, 0.000213,
0.000212, 0.000211, 0.000210, 0.000209, 0.000208, 0.000207, 0.000206,
0.000205, 0.000204, 0.000203, 0.000202, 0.000201, 0.000200, 0.000199,
0.000198, 0.000197, 0.000196, 0.000195, 0.000194, 0.000193, 0.000192,
0.000191, 0.000190, 0.000190, 0.000189, 0.000188, 0.000187, 0.000186,
0.000185, 0.000184, 0.000183, 0.000182, 0.000181, 0.000181, 0.000180,
0.000179, 0.000178, 0.000177, 0.000176, 0.000175, 0.000174, 0.000174,
0.000173, 0.000172, 0.000171, 0.000170, 0.000169, 0.000169, 0.000168,
0.000167, 0.000166, 0.000165, 0.000165, 0.000164, 0.000163, 0.000162,
0.000161, 0.000161, 0.000160, 0.000159, 0.000158, 0.000157, 0.000157,
0.000156, 0.000155, 0.000154, 0.000154, 0.000153, 0.000152, 0.000151,
0.000151, 0.000150, 0.000149, 0.000148, 0.000148, 0.000147, 0.000146,
0.000146, 0.000145, 0.000144, 0.000143, 0.000143, 0.000142, 0.000141,
0.000141, 0.000140, 0.000139, 0.000139, 0.000138, 0.000137, 0.000137,
0.000136, 0.000135, 0.000134, 0.000134, 0.000133, 0.000133, 0.000132,
0.000131, 0.000131, 0.000130, 0.000129, 0.000129, 0.000128, 0.000127,
0.000127, 0.000126, 0.000125, 0.000125, 0.000124, 0.000124, 0.000123,
0.000122, 0.000122, 0.000121, 0.000121, 0.000120, 0.000119, 0.000119,
0.000118, 0.000118, 0.000117, 0.000116, 0.000116, 0.000115, 0.000115,
0.000114, 0.000114, 0.000113, 0.000112, 0.000112, 0.000111, 0.000111,
0.000110, 0.000110, 0.000109, 0.000109, 0.000108, 0.000107, 0.000107,
0.000106, 0.000106, 0.000105, 0.000105, 0.000104, 0.000104, 0.000103,
0.000103, 0.000102, 0.000102, 0.000101, 0.000101, 0.000100, 0.000100,
0.000099, 0.000099, 0.000098, 0.000098, 0.000097, 0.000097, 0.000096,
0.000096, 0.000095, 0.000095, 0.000094, 0.000094, 0.000093, 0.000093,
0.000092, 0.000092, 0.000092, 0.000091, 0.000091, 0.000090, 0.000090,
0.000089, 0.000089, 0.000088, 0.000088, 0.000087, 0.000087, 0.000087,
0.000086, 0.000086, 0.000085, 0.000085, 0.000084, 0.000084, 0.000084,
0.000083, 0.000083, 0.000082, 0.000082, 0.000081, 0.000081, 0.000081,
0.000080, 0.000080, 0.000079, 0.000079, 0.000079, 0.000078, 0.000078,
0.000077, 0.000077, 0.000077, 0.000076, 0.000076, 0.000075, 0.000075,
0.000075, 0.000074, 0.000074, 0.000074, 0.000073, 0.000073, 0.000072,
0.000072, 0.000072, 0.000071, 0.000071, 0.000071, 0.000070, 0.000070,
0.000069, 0.000069, 0.000069, 0.000068, 0.000068, 0.000068, 0.000067,
0.000067, 0.000067, 0.000066, 0.000066, 0.000066, 0.000065, 0.000065,
0.000065, 0.000064, 0.000064, 0.000064, 0.000063, 0.000063, 0.000063,
0.000062, 0.000062, 0.000062, 0.000061, 0.000061, 0.000061, 0.000060,
0.000060, 0.000060, 0.000060, 0.000059, 0.000059, 0.000059, 0.000058,
0.000058, 0.000058, 0.000057, 0.000057, 0.000057, 0.000057, 0.000056,
0.000056, 0.000056, 0.000055, 0.000055, 0.000055, 0.000055, 0.000054,
0.000054, 0.000054, 0.000053, 0.000053, 0.000053, 0.000053, 0.000052,
0.000052, 0.000052, 0.000051, 0.000051, 0.000051, 0.000051, 0.000050,
0.000050, 0.000050, 0.000050, 0.000049, 0.000049, 0.000049, 0.000049,
0.000048, 0.000048, 0.000048, 0.000048, 0.000047, 0.000047, 0.000047,
0.000047, 0.000046, 0.000046, 0.000046, 0.000046, 0.000045, 0.000045,
0.000045, 0.000045, 0.000044, 0.000044, 0.000044, 0.000044, 0.000044,
0.000043, 0.000043, 0.000043, 0.000043, 0.000042, 0.000042, 0.000042,
0.000042, 0.000042, 0.000041, 0.000041, 0.000041, 0.000041, 0.000040,
0.000040, 0.000040, 0.000040, 0.000040, 0.000039, 0.000039, 0.000039,
0.000039, 0.000039, 0.000038, 0.000038, 0.000038, 0.000038, 0.000038,
0.000037, 0.000037, 0.000037, 0.000037, 0.000037, 0.000036, 0.000036,
0.000036, 0.000036, 0.000036, 0.000035, 0.000035, 0.000035, 0.000035,
0.000035, 0.000034, 0.000034, 0.000034, 0.000034, 0.000034, 0.000034,
0.000033, 0.000033, 0.000033, 0.000033, 0.000033, 0.000033, 0.000032,
0.000032, 0.000032, 0.000032, 0.000032, 0.000031, 0.000031, 0.000031,
0.000031, 0.000031, 0.000031, 0.000030, 0.000030, 0.000030, 0.000030,
0.000030, 0.000030, 0.000030, 0.000029, 0.000029, 0.000029, 0.000029,
0.000029, 0.000029, 0.000028, 0.000028, 0.000028, 0.000028, 0.000028,
0.000028, 0.000028, 0.000027, 0.000027, 0.000027, 0.000027, 0.000027,
0.000027, 0.000027, 0.000026, 0.000026, 0.000026, 0.000026, 0.000026,
0.000026, 0.000026, 0.000025, 0.000025, 0.000025, 0.000025, 0.000025,
0.000025, 0.000025, 0.000024, 0.000024, 0.000024, 0.000024, 0.000024,
0.000024, 0.000024, 0.000024, 0.000023, 0.000023, 0.000023, 0.000023,
0.000023, 0.000023, 0.000023, 0.000023, 0.000022, 0.000022, 0.000022,
0.000022, 0.000022, 0.000022, 0.000022, 0.000022, 0.000021, 0.000021,
0.000021, 0.000021, 0.000021, 0.000021, 0.000021, 0.000021, 0.000021,
0.000020, 0.000020, 0.000020, 0.000020, 0.000020, 0.000020, 0.000020,
0.000020, 0.000020, 0.000019, 0.000019, 0.000019, 0.000019, 0.000019,
0.000019, 0.000019, 0.000019, 0.000019, 0.000019, 0.000018, 0.000018,
0.000018, 0.000018, 0.000018, 0.000018, 0.000018, 0.000018, 0.000018,
0.000018, 0.000017, 0.000017, 0.000017, 0.000017, 0.000017, 0.000017,
0.000017, 0.000017, 0.000017, 0.000017, 0.000016, 0.000016, 0.000016,
0.000016, 0.000016, 0.000016, 0.000016, 0.000016, 0.000016, 0.000016,
0.000016, 0.000016, 0.000015, 0.000015, 0.000015, 0.000015, 0.000015,
0.000015, 0.000015, 0.000015, 0.000015, 0.000015, 0.000015, 0.000015,
0.000014, 0.000014, 0.000014, 0.000014, 0.000014, 0.000014, 0.000014,
0.000014, 0.000014, 0.000014, 0.000014, 0.000014, 0.000014, 0.000013,
0.000013, 0.000013, 0.000013, 0.000013, 0.000013, 0.000013, 0.000013,
0.000013, 0.000013, 0.000013, 0.000013, 0.000013, 0.000012, 0.000012,
0.000012, 0.000012, 0.000012, 0.000012, 0.000012, 0.000012, 0.000012,
0.000012, 0.000012, 0.000012, 0.000012, 0.000012, 0.000012, 0.000011,
0.000011, 0.000011, 0.000011, 0.000011, 0.000011, 0.000011, 0.000011,
0.000011, 0.000011, 0.000011, 0.000011, 0.000011, 0.000011, 0.000011,
0.000011, 0.000011, 0.000010, 0.000010, 0.000010, 0.000010, 0.000010,
0.000010, 0.000010, 0.000010, 0.000010, 0.000010, 0.000010, 0.000010,
0.000010, 0.000010, 0.000010, 0.000010, 0.000010, 0.000009, 0.000009,
0.000009, 0.000009, 0.000009, 0.000009, 0.000009, 0.000009, 0.000009,
0.000009, 0.000009, 0.000009, 0.000009, 0.000009, 0.000009, 0.000009,
0.000009, 0.000009, 0.000009, 0.000009, 0.000008, 0.000008, 0.000008,
0.000008, 0.000008, 0.000008, 0.000008, 0.000008, 0.000008, 0.000008,
0.000008, 0.000008, 0.000008, 0.000008, 0.000008, 0.000008, 0.000008,
0.000008, 0.000008, 0.000008, 0.000008, 0.000008, 0.000007, 0.000007,
0.000007, 0.000007, 0.000007, 0.000007, 0.000007, 0.000007, 0.000007,
0.000007, 0.000007, 0.000007, 0.000007, 0.000007, 0.000007, 0.000007,
0.000007, 0.000007, 0.000007, 0.000007, 0.000007, 0.000007, 0.000007,
0.000007, 0.000007, 0.000006, 0.000006, 0.000006, 0.000006, 0.000006,
0.000006, 0.000006, 0.000006, 0.000006, 0.000006, 0.000006, 0.000006,
0.000006, 0.000006, 0.000006, 0.000006, 0.000006, 0.000006, 0.000006,
0.000006, 0.000006, 0.000006, 0.000006, 0.000006, 0.000006, 0.000006,
0.000006, 0.000006, 0.000006, 0.000005, 0.000005, 0.000005, 0.000005,
0.000005, 0.000005, 0.000005, 0.000005, 0.000005, 0.000005, 0.000005,
0.000005, 0.000005, 0.000005, 0.000005, 0.000005, 0.000005, 0.000005,
0.000005, 0.000005, 0.000005, 0.000005, 0.000005, 0.000005, 0.000005,
0.000005, 0.000005, 0.000005, 0.000005, 0.000005, 0.000005, 0.000005,
0.000005, 0.000005, 0.000004, 0.000004, 0.000004, 0.000004, 0.000004,
0.000004, 0.000004, 0.000004, 0.000004, 0.000004, 0.000004, 0.000004,
0.000004, 0.000004, 0.000004, 0.000004, 0.000004, 0.000004, 0.000004,
0.000004, 0.000004, 0.000004, 0.000004, 0.000004, 0.000004, 0.000004,
0.000004, 0.000004, 0.000004, 0.000004, 0.000004, 0.000004, 0.000004,
0.000004, 0.000004, 0.000004, 0.000004, 0.000004, 0.000004, 0.000004,
0.000004, 0.000004, 0.000004, 0.000003, 0.000003, 0.000003, 0.000003,
0.000003, 0.000003, 0.000003, 0.000003, 0.000003, 0.000003, 0.000003,
0.000003, 0.000003, 0.000003, 0.000003, 0.000003, 0.000003, 0.000003,
0.000003, 0.000003, 0.000003, 0.000003, 0.000003, 0.000003, 0.000003,
0.000003, 0.000003, 0.000003, 0.000003, 0.000003, 0.000003, 0.000003,
0.000003, 0.000003, 0.000003, 0.000003, 0.000003, 0.000003, 0.000003,
0.000003, 0.000003, 0.000003, 0.000003, 0.000003, 0.000003, 0.000003,
0.000003, 0.000003, 0.000003, 0.000003, 0.000003, 0.000003, 0.000003,
0.000003, 0.000003, 0.000003, 0.000002, 0.000002, 0.000002, 0.000002,
0.000002, 0.000002, 0.000002, 0.000002, 0.000002, 0.000002, 0.000002,
0.000002, 0.000002, 0.000002, 0.000002, 0.000002, 0.000002, 0.000002,
0.000002, 0.000002, 0.000002, 0.000002, 0.000002, 0.000002, 0.000002,
0.000002, 0.000002, 0.000002, 0.000002, 0.000002, 0.000002, 0.000002,
0.000002, 0.000002, 0.000002, 0.000002, 0.000002, 0.000002, 0.000002,
0.000002, 0.000002, 0.000002, 0.000002, 0.000002, 0.000002, 0.000002,
0.000002, 0.000002, 0.000002, 0.000002, 0.000002, 0.000002, 0.000002,
0.000002, 0.000002, 0.000002, 0.000002, 0.000002, 0.000002, 0.000002,
0.000002, 0.000002, 0.000002, 0.000002, 0.000002, 0.000002, 0.000002,
0.000002, 0.000002, 0.000002, 0.000002, 0.000002, 0.000002, 0.000002,
0.000002, 0.000002, 0.000002, 0.000002, 0.000002, 0.000002, 0.000002,
0.000002, 0.000002, 0.000002, 0.000002, 0.000001, 0.000001, 0.000001,
0.000001, 0.000001, 0.000001, 0.000001, 0.000001, 0.000001, 0.000001,
0.000001, 0.000001, 0.000001, 0.000001, 0.000001, 0.000001, 0.000001,
0.000001, 0.000001, 0.000001, 0.000001, 0.000001, 0.000001, 0.000001,
0.000001, 0.000001, 0.000001, 0.000001, 0.000001, 0.000001, 0.000001,
0.000001, 0.000001, 0.000001, 0.000001, 0.000001, 0.000001, 0.000001,
0.000001, 0.000001, 0.000001, 0.000001, 0.000001, 0.000001, 0.000001,
0.000001, 0.000001, 0.000001, 0.000001, 0.000001, 0.000001, 0.000001,
0.000001, 0.000001, 0.000001, 0.000001, 0.000001, 0.000001, 0.000001,
0.000001, 0.000001, 0.000001, 0.000001, 0.000001, 0.000001, 0.000001,
0.000001, 0.000001, 0.000001, 0.000001, 0.000001, 0.000001, 0.000001,
0.000001, 0.000001, 0.000001, 0.000001, 0.000001, 0.000001, 0.000001,
0.000001, 0.000001, 0.000001, 0.000001, 0.000001, 0.000001, 0.000001,
0.000001, 0.000001, 0.000001, 0.000001, 0.000001, 0.000001, 0.000001,
0.000001, 0.000001, 0.000001, 0.000001, 0.000001, 0.000001, 0.000001,
0.000001, 0.000001, 0.000001, 0.000001, 0.000001, 0.000001, 0.000001,
0.000001, 0.000001, 0.000001, 0.000001, 0.000001, 0.000001, 0.000001,
0.000001, 0.000001, 0.000001, 0.000001, 0.000001, 0.000001, 0.000001,
0.000001, 0.000001, 0.000001, 0.000001, 0.000001, 0.000001, 0.000001,
0.000001, 0.000001, 0.000001, 0.000001, 0.000001, 0.000001, 0.000001,
0.000001, 0.000001, 0.000001, 0.000001, 0.000001, 0.000001, 0.000001,
0.000001, 0.000001, 0.000001, 0.000001, 0.000001, 0.000001, 0.000001,
0.000001, 0.000001, 0.000001, 0.000001, 0.000001 };

#define MOD(a, b)		(((b) + (a) % (b)) % (b))
#define GET(buf, M, N, i, j)	(buf[MOD(i, M) * N + MOD(j, N)])
#define SIGN(a)	((a) < 0 ? -1 : ((a) > 0 ? 1 : 0))

typedef struct
{
  double data[2];
} double2;

/* conquier phase of merge sort algorithm */
static int merge(double2* left,  int nl,
		 double2* right, int nr,
		 int idx, double2* tmp)
{
  int kl, kr, k;
  int i; /* number of inversions in bubble sort */

  kl = 0;
  kr = 0;
  i = 0;
  for (k = 0; k < nl + nr; ++k)
    if (kr == nr ||
	(kl < nl && (left[kl].data[idx] < right[kr].data[idx] ||
		     (left[kl].data[idx] == right[kr].data[idx] && left[kl].data[1-idx] <= right[kr].data[1-idx]))))
      {
	tmp[k].data[0] = left[kl].data[0];
	tmp[k].data[1] = left[kl].data[1];
	++kl;
      }
    else
      {
	tmp[k].data[0] = right[kr].data[0];
	tmp[k].data[1] = right[kr].data[1];
	++kr;
	i += nl - kl;
      }
  for (k = 0; k < nl + nr; ++k)
    {
      left[k].data[0] = tmp[k].data[0];
      left[k].data[1] = tmp[k].data[1];
    }
  return i;
}

/* merge sort algorithm (divide phase)
   return number of swaps that a bubble sort would have done */
static int merge_sort(double2* buf, int n, int idx, double2* tmp)
{
  int m;
  int i, j;

  if (n <= 1)
    return 0;
  m = n / 2;
  i = merge_sort(buf, m, idx, tmp);
  j = merge_sort(buf + m, n - m, idx, tmp);
  return i + j + merge(buf, m, buf + m, n - m, idx, tmp);
}

/* Compute Kendall-tau coefficient in O(n log n) (not accounting for ties) */
static double2 kendalltau_noties(double2* buf, long n)
{
  double2* buf1;
  double2* buf2;
  double2* tmp;
  double2 tau_z;
  long n0;
  double v;
  int disc; /* number of discordant pairs */
  int conc; /* number of concordant pairs */

  buf1 = malloc(n * sizeof(double2));
  buf1 = memcpy(buf1, buf, n * sizeof(double2));
  buf2 = malloc(n * sizeof(double2));
  buf2 = memcpy(buf2, buf, n * sizeof(double2));
  tmp = malloc(n * sizeof(double2));
  merge_sort(buf1, n, 0, tmp);
  merge_sort(buf2, n, 1, tmp);
  n0 = n * (n - 1) / 2; /* number of pairs */
  v = n * (n - 1) * (2 * n + 5) / 2;
  disc = merge_sort(buf1, n, 1, tmp);
  conc = n0 - disc;
  tau_z.data[0] = (conc - disc) / (double) n0;
  tau_z.data[1] = 3 * (conc - disc) / sqrt(v);
  free(buf1);
  free(buf2);
  free(tmp);
  return tau_z;
}

/* Compute Kendall-tau coefficient in O(n log n) (accounting for ties) */
static double2 kendalltau(double2* buf, long n)
{
  double2* buf1;
  double2* buf2;
  double2* tmp;
  double2 tau_z;
  long n0, n1, n2, n3, t;
  long v0, v1, v2, v11, v22;
  double v;
  int disc; /* number of discordant pairs */
  int conc; /* number of concordant pairs */
  int k;

  buf1 = malloc(n * sizeof(double2));
  buf1 = memcpy(buf1, buf, n * sizeof(double2));
  buf2 = malloc(n * sizeof(double2));
  buf2 = memcpy(buf2, buf, n * sizeof(double2));
  tmp = malloc(n * sizeof(double2));
  merge_sort(buf1, n, 0, tmp);
  merge_sort(buf2, n, 1, tmp);
  n0 = n * (n - 1) / 2; /* number of pairs */
  v0 = n * (n - 1) * (2 * n + 5);
  n1 = 0; /* pair of ties wrt first list */
  n2 = 0; /* pair of ties wrt second list */
  n3 = 0; /* pair of ties wrt both list */
  v1 = 0;
  v2 = 0;
  v11 = 0;
  v22 = 0;
  t = 1;
  for (k = 0; k < n - 1; ++k)
      if (buf1[k].data[0] == buf1[k+1].data[0])
	++t;
      else
	{
	  n1 += t * (t - 1) / 2;
	  v1 += t * (t - 1) * (2 * t + 5);
	  v11 += t * (t - 1) * (t - 2);
	  t = 1;
	}
  n1 += t * (t - 1) / 2;
  v1 += t * (t - 1) * (2 * t + 5);
  v11 += t * (t - 1) * (t - 2);
  t = 1;
  for (k = 0; k < n - 1; ++k)
    if (buf2[k].data[1] == buf2[k+1].data[1])
	++t;
    else
      {
	n2 += t * (t - 1) / 2;
	v2 += t * (t - 1) * (2 * t + 5);
	v22 += t * (t - 1) * (t - 2);
	t = 1;
      }
  n2 += t * (t - 1) / 2;
  v2 += t * (t - 1) * (2 * t + 5);
  v22 += t * (t - 1) * (t - 2);
  t = 1;
  for (k = 0; k < n - 1; ++k)
    {
    if (buf2[k].data[0] == buf2[k+1].data[0] && buf2[k].data[1] == buf2[k+1].data[1])
	++t;
    else
      {
	n3 += t * (t - 1) / 2;
	t = 1;
      }
    }
  n3 += t * (t - 1) / 2;
  v =
    (v0 - v1 - v2) / 18.0 +
    n1 * n2 / (double) n0 +
    v11 * v22 / (9.0 * n * (n - 1) * (n - 2));
  disc = merge_sort(buf1, n, 1, tmp);
  conc = n0 - n1 - n2 + n3 - disc;
  tau_z.data[0] = (conc - disc) / sqrt((n0 - n1) * (n0 - n2));
  tau_z.data[1] = (conc - disc) / sqrt(v);
  free(buf1);
  free(buf2);
  free(tmp);
  return tau_z;
}

/* Compute Kendall-tau coefficient in O(n^2) (not accounting for ties) */
static double2 kendalltau_naive_noties(double2* buf, long n)
{
  int i, j;
  double2 tau_z;
  long n0;
  double v;

  n0 = n * (n - 1) / 2;
  v = n * (n - 1) * (2 * n + 5) / 2;
  tau_z.data[0] = 0;
  for (i = 1; i < n; ++i)
    for (j = 0; j < i; ++j)
      tau_z.data[0] += SIGN(buf[i].data[0] - buf[j].data[0]) * SIGN(buf[i].data[1] - buf[j].data[1]);
  tau_z.data[1] = 3 * tau_z.data[0] / sqrt(v);
  tau_z.data[0] /= n0;
  return tau_z;
}

/* Compute Kendall-tau coefficient in O(n^2) (accounting for ties) */
static double2 kendalltau_naive(double2* buf, long n)
{
  int i, j, k;
  double2 tau_z;
  double2* buf1;
  double2* buf2;
  double2* tmp;
  long n0, n1, n2, t;
  long v0, v1, v2, v11, v22;
  double v;

  buf1 = malloc(n * sizeof(double2));
  buf1 = memcpy(buf1, buf, n * sizeof(double2));
  buf2 = malloc(n * sizeof(double2));
  buf2 = memcpy(buf2, buf, n * sizeof(double2));
  tmp = malloc(n * sizeof(double2));
  merge_sort(buf1, n, 0, tmp);
  merge_sort(buf2, n, 1, tmp);
  n0 = n * (n - 1) / 2; /* number of pairs */
  v0 = n * (n - 1) * (2 * n + 5);
  n1 = 0; /* pair of ties wrt first list */
  n2 = 0; /* pair of ties wrt second list */
  v1 = 0;
  v2 = 0;
  v11 = 0;
  v22 = 0;
  t = 1;
  for (k = 0; k < n - 1; ++k)
      if (buf1[k].data[0] == buf1[k+1].data[0])
	++t;
      else
	{
	  n1 += t * (t - 1) / 2;
	  v1 += t * (t - 1) * (2 * t + 5);
	  v11 += t * (t - 1) * (t - 2);
	  t = 1;
	}
  n1 += t * (t - 1) / 2;
  v1 += t * (t - 1) * (2 * t + 5);
  v11 += t * (t - 1) * (t - 2);
  t = 1;
  for (k = 0; k < n - 1; ++k)
    if (buf2[k].data[1] == buf2[k+1].data[1])
	++t;
    else
      {
	n2 += t * (t - 1) / 2;
	v2 += t * (t - 1) * (2 * t + 5);
	v22 += t * (t - 1) * (t - 2);
	t = 1;
      }
  n2 += t * (t - 1) / 2;
  v2 += t * (t - 1) * (2 * t + 5);
  v22 += t * (t - 1) * (t - 2);
  v =
    (v0 - v1 - v2) / 18.0 +
    n1 * n2 / (double) n0 +
    v11 * v22 / (9.0 * n * (n - 1) * (n - 2));
  tau_z.data[0] = 0;
  for (i = 1; i < n; ++i)
    for (j = 0; j < i; ++j)
      tau_z.data[0] += SIGN(buf[i].data[0] - buf[j].data[0]) * SIGN(buf[i].data[1] - buf[j].data[1]);
  tau_z.data[1] = tau_z.data[0] / sqrt(v);
  tau_z.data[0] /= sqrt((n0 - n1) * (n0 - n2));
  free(buf1);
  free(buf2);
  return tau_z;
}

/* Get p-value for 2sided test on z ~ N(0, 1) */
static double pvalue_2sided_from_z(double z)
{
  if (isnan(z))
    return NAN;
  z = fabs(z);
  if (z > normpvalues_2sided_max)
    return 0;
  else
    return normpvalues_2sided[(int) roundf((normpvalues_2sided_size-1) * z /
					   normpvalues_2sided_max)];
}

/* Compute tau on non-overlapping moving windows */
static int core(double* ima, double* ima_tau, double* ima_pvalue,
		int M, int N, int W, int dx, int dy,
		double2 (*kendalltau_func)(double2*, long))
{
  int* mask;
  double2* buf;
  double2 tau_z;
  double pvalue;
  int ij, i, j, k, l;
  long s;

  buf = malloc(W * W * sizeof(double2));
  for (k = 0; k < M*N; ++k)
    ima_tau[k] = NAN;
  if (ima_pvalue)
    ima_pvalue = memcpy(ima_pvalue, ima_tau, M*N * sizeof(double));
  mask = calloc(W * W, sizeof(int));
  for (k = 0; k < W; ++k)
    for (l = 0; l < W; ++l)
      if (!GET(mask, W, W, k, l) && !GET(mask, W, W, k + dx, l + dy))
	{
	  GET(mask, W, W, k, l) = 1;
	  GET(mask, W, W, k + dx, l + dy) = 2;
	}
#pragma omp parallel default(shared) private(ij, i, j, k, l, s, tau_z, pvalue)
  {
# pragma omp for schedule(dynamic) nowait
    for (ij = 0; ij < (M / W) * (N / W); ++ij)
      {
	i = W * (ij / (N / W));
	j = W * (ij % (N / W));
	s = 0;
	for (k = 0; k < W; ++k)
	  for (l = 0; l < W; ++l)
	    if (GET(mask, W, W, k, l) == 1)
	      {
		buf[s].data[0] = GET(ima, M, N, i + k, j + l);
		buf[s].data[1] = GET(ima, M, N, i + k + dx, j + l + dy);
		++s;
	      }
	tau_z = kendalltau_func(buf, s);
	for (k = 0; k < W; ++k)
	  for (l = 0; l < W; ++l)
	    GET(ima_tau, M, N, i + k, j + l) = tau_z.data[0];
	if (ima_pvalue)
	  {
	    pvalue = pvalue_2sided_from_z(tau_z.data[1]);
	    for (k = 0; k < W; ++k)
	      for (l = 0; l < W; ++l)
		GET(ima_pvalue, M, N, i + k, j + l) = pvalue;
	  }
      }
  }
  free(buf);
  free(mask);
  return 0;
}

#ifdef MATLAB_MEX_FILE
# define isScalarValue(a) (mxIsNumeric(a) && !mxIsComplex(a) && mxGetM(a) == 1 && mxGetN(a) == 1)

static void usage()
{
  char str[1024];
  sprintf(str,
	  "usage: [tau, pvalue] = kendalltau(image, window_size, dx, dy,\n" \
	  "                                  ['fast' | 'noties' | 'naive' | 'naive-noties'])\n");
  mexErrMsgTxt(str);
}

void mexFunction(int nlhs, mxArray *plhs[],
		 int nrhs, const mxArray *prhs[])
{
  double* ima;
  double* ima_tau;
  double* ima_pvalue;
  int W, dx, dy;
  int M, N;
  const mwSize* sizes;
  double2 (*kendalltau_func)(double2*, long) = kendalltau;

  if (nrhs < 4 || nrhs > 5 || nlhs > 2)
    {
      usage();
      return;
    }
  if (mxIsDouble(prhs[0]) != 1 || mxIsNumeric(prhs[0]) != 1 ||
      mxGetNumberOfDimensions(prhs[0]) != 2 ||
      !isScalarValue(prhs[1]) ||
      !isScalarValue(prhs[2]) ||
      !isScalarValue(prhs[3]) ||
      (nrhs >= 5 && (!mxIsChar(prhs[4]) || mxGetM(prhs[4]) != 1)))
    {
      usage();
      return;
    }
  if (nrhs >= 5)
    {
      int type_len = mxGetM(prhs[4]) * mxGetN(prhs[4]) + 1;
      char* type  = mxCalloc(type_len, sizeof(char));
      mxGetString(prhs[4], type, type_len);
      if (!strcmp(type, "fast"))
	kendalltau_func = kendalltau;
      else
	if (!strcmp(type, "noties"))
	  kendalltau_func = kendalltau_noties;
	else
	  if (!strcmp(type, "naive"))
	    kendalltau_func = kendalltau_naive;
	  else
	    if (!strcmp(type, "naive-noties"))
	      kendalltau_func = kendalltau_naive_noties;
	    else
	      {
		usage();
		return;
	      }
    };
  sizes = mxGetDimensions(prhs[0]);
  M = sizes[1];
  N = sizes[0];
  ima = mxGetData(prhs[0]);
  W = (int) *mxGetPr(prhs[1]);
  dx = (int) *mxGetPr(prhs[2]);
  dy = (int) *mxGetPr(prhs[3]);

  plhs[0] = mxCreateNumericArray(2, sizes, mxDOUBLE_CLASS, mxREAL);
  ima_tau = mxGetData(plhs[0]);
  if (nlhs >= 2)
    {
      plhs[1] = mxCreateNumericArray(2, sizes, mxDOUBLE_CLASS, mxREAL);
      ima_pvalue = mxGetData(plhs[1]);
    }
  else
    ima_pvalue = NULL;
  switch (core(ima, ima_tau, ima_pvalue, M, N, W, dx, dy,
	       kendalltau_func))
    {
      case 0:
	break;
	;;
      default:
	mexErrMsgTxt("Unexpected error");
	;;
    }
}

#else

/* For debugging only */
int main(int argc, char* argv[])
{
  double* ima;
  double* ima_tau;
  double* ima_pvalue;
  int M, N, W, dx, dy;
  int i, k;
  int res;

  if (argc < 6)
    {
      fprintf(stderr, "usage: %s M N W dx dy\n", argv[0]);
      return 1;
    }
  sscanf(argv[1], "%d", &M);
  sscanf(argv[2], "%d", &N);
  sscanf(argv[3], "%d", &W);
  sscanf(argv[4], "%d", &dx);
  sscanf(argv[5], "%d", &dy);
  ima = malloc(M * N * sizeof(double));
  ima_tau = malloc(M * N * sizeof(double));
  ima_pvalue = malloc(M * N * sizeof(double));
  for (i = 0; i < M*N; ++i)
    ima[i] = 0;
  res = core(ima, ima_tau, ima_pvalue, M, N, W, dx, dy,
	     kendalltau);
  free(ima);
  free(ima_tau);
  free(ima_pvalue);

  double2 buf[5];
  srand(time(NULL));
  buf[0].data[0] = 1;
  buf[0].data[1] = 1;
  buf[1].data[0] = 2;
  buf[1].data[1] = 1;
  buf[2].data[0] = 2;
  buf[2].data[1] = 1;
  buf[3].data[0] = 3;
  buf[3].data[1] = 2;
  buf[4].data[0] = 1;
  buf[4].data[1] = 2;

  printf("Test without ties:\n");
  for (k = 0; k < 5; ++k)
    printf("\t(%f, %f)\n",  buf[k].data[0], buf[k].data[1]);
  printf("\tnaive:\t\t%.2f %.2f\n\tnaive+ties:\t%.2f %.2f\n\tfast:\t\t%.2f %.2f\n\tfast+ties:\t%.2f %.2f\n",
	 kendalltau_naive_noties(buf, 5).data[0], kendalltau_naive_noties(buf, 5).data[1],
	 kendalltau_naive(buf, 5).data[0], kendalltau_naive(buf, 5).data[1],
	 kendalltau_noties(buf, 5).data[0], kendalltau_noties(buf, 5).data[1],
	 kendalltau(buf, 5).data[0], kendalltau(buf, 5).data[1]);

  printf("Test with ties:\n");
  for (k = 0; k < 5; ++k)
    {

      buf[k].data[0] += 0.1 * (rand() - RAND_MAX/2.0) / (double) RAND_MAX;
      buf[k].data[1] += 0.1 * (rand() - RAND_MAX/2.0) / (double) RAND_MAX;
      printf("\t(%f, %f)\n",  buf[k].data[0], buf[k].data[1]);
    }
  printf("\tnaive:\t\t%.2f %.2f\n\tnaive+ties:\t%.2f %.2f\n\tfast:\t\t%.2f %.2f\n\tfast+ties:\t%.2f %.2f\n",
	 kendalltau_naive_noties(buf, 5).data[0], kendalltau_naive_noties(buf, 5).data[1],
	 kendalltau_naive(buf, 5).data[0], kendalltau_naive(buf, 5).data[1],
	 kendalltau_noties(buf, 5).data[0], kendalltau_noties(buf, 5).data[1],
	 kendalltau(buf, 5).data[0], kendalltau(buf, 5).data[1]);

  return res;
}

#endif
